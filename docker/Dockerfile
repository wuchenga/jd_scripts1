FROM node:lts-alpine3.12

LABEL AUTHOR="none" \
      VERSION=0.1.4

ARG KEY="-----BEGIN OPENSSH PRIVATE KEY-----\n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\n-----END OPENSSH PRIVATE KEY-----"

ENV DEFAULT_LIST_FILE=crontab_list.sh \
    CUSTOM_LIST_MERGE_TYPE=append \
    COOKIES_LIST=/scripts/logs/cookies.list \
    REPO_URL=git@gitee.com:superbei666/jd_scripts.git \
    REPO_BRANCH=master

RUN set -ex \
    && apk update \
    && apk upgrade \
    && apk add --no-cache bash tzdata git moreutils curl jq openssh-client \
    && rm -rf /var/cache/apk/* \
    && ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \
    && echo "Asia/Shanghai" > /etc/timezone \
    && mkdir -p /root/.ssh \
    && echo -e $KEY > /root/.ssh/id_rsa \
    && chmod 600 /root/.ssh/id_rsa \
    && ssh-keyscan gitee.com > /root/.ssh/known_hosts \
    && git clone -b $REPO_BRANCH $REPO_URL /scripts \
    && cd /scripts \
    && mkdir logs \
    && npm config set registry https://registry.npm.taobao.org \
    && npm install \
    && cp /scripts/docker/docker_entrypoint.sh /usr/local/bin \
    && chmod +x /usr/local/bin/docker_entrypoint.sh

WORKDIR /scripts

ENTRYPOINT ["docker_entrypoint.sh"]

CMD [ "crond" ]